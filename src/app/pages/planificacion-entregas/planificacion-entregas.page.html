<ion-header class="ion-no-border">
  <ion-toolbar color="dark">


    <ion-list style="background: transparent!important;margin:0;padding:0" lines="none">
      <ion-item>
        <ion-title class="ion-text-left" style="font-size: 0.9rem;letter-spacing: 0.2rem; text-transform: uppercase;" color="light">Planificación de Entregas</ion-title>

        <ion-label color="light">
          <h2 class="ion-text-uppercase">Ruta</h2>
          <p *ngIf="controlCamionesGuiasService.rutaZona">
            <ion-badge color="primary" mode="ios" >{{controlCamionesGuiasService.rutaZona.Ruta}}</ion-badge>
          </p>
        </ion-label>
        <ion-label color="light">
          <h2 class="ion-text-uppercase">Zona</h2>
          <p  *ngIf="controlCamionesGuiasService.rutaZona">
            <ion-badge color="primary" mode="ios">{{controlCamionesGuiasService.rutaZona.Descripcion}}</ion-badge>
          </p>
        </ion-label>
  
        <ion-buttons slot="end" >

          <ion-button   [routerLink]="['/inicio']" fill="solid" shape="round" color="dark" size="small">
            <ion-icon name="home-outline"></ion-icon>
          </ion-button>
  
          <ion-button  shape="round" fill="solid" color="dark" (click)="gestionErrores()">
            <ion-icon  name="bug"></ion-icon>
            <ion-badge color="primary" mode="ios">{{planificacionEntregasService.errorArray.length}}</ion-badge>
          </ion-button>
          <ion-button   *ngIf="controlCamionesGuiasService.rutaZona" (click)="limpiarDatos()"  shape="round" fill="solid" color="dark">
            <ion-icon  name="refresh"></ion-icon>
          </ion-button>
          <ion-button  shape="round" fill="solid" color="dark" (click)="configuracionZonaRuta()">
            <ion-icon class="spin-element"  name="settings"></ion-icon>
          </ion-button>
          <ion-button *ngIf="controlCamionesGuiasService.rutaZona" shape="round" fill="solid" color="dark" (click)="calendarioModal()">
            <ion-icon   name="calendar"></ion-icon>
          </ion-button>
  
          <ion-button    [routerLink]="['/log-in']" fill="solid" shape="round" color="danger" size="small">
            <ion-label slot="start">Salir</ion-label>
            <ion-icon name="close" slot="end"> </ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-list>
  </ion-toolbar>
</ion-header>

<ion-content>

<ion-grid style="height:95%" >


  
  <ion-row style="height:100%;display:flex ;justify-content:center;align-items:center;" *ngIf="facturas.length == 0" >
    <ion-col size="12" >
  
      <ion-row>
        <ion-col size="12" class="ion-text-center">
          <img  height="150" src="../assets/svgs/search.svg" alt="">
        </ion-col>
        <ion-col size="12" class="ion-text-center">
        Debes filtrar por Ruta Zona para continuar
        </ion-col>
      </ion-row>
     

    </ion-col>
   
  </ion-row>


<ion-row>
  <ion-col   size="4" *ngIf="controlCamionesGuiasService.listaGuias.length > 0">
    <ion-row >

      <ion-col  size="12">  
        <ion-toolbar>
          <ion-title class="ion-text-uppercase">Lista De guias <ion-badge color="warning" mode="ios">{{controlCamionesGuiasService.listaGuias.length}}</ion-badge></ion-title>
      
          <ion-button class="ion-margin" color="dark" *ngIf="controlCamionesGuiasService.listaGuias.length > 0" (click)="exportarGuias()" expand="block" fill="solid">
            <ion-icon slot="start"   name="save"></ion-icon>
            Guardar Guias
          </ion-button>
         </ion-toolbar>
      </ion-col>

      
      <ion-col   class="ion-padding fixed-content" size="12" >
  
        <ion-card *ngFor="let guia of controlCamionesGuiasService.listaGuias;let i = index;" >
    
          <ion-card-content style="text-align: left;">
            <ion-grid >
              <ion-row>
         
                <ion-col size="6">
                  <ion-badge color="dark" mode="ios">{{ guia.guiaExistente ? 'Guia existente' : 'Nueva Guia'}}</ion-badge></ion-col>
                  <ion-col size="6"> {{guia.idGuia}}</ion-col>
                <ion-col size="12">{{guia.camion.chofer}}</ion-col>
                <ion-col size="{{guia.verificada ? 6 : 12}}"><strong>Placa</strong> : {{guia.camion.idCamion}}</ion-col>
                <ion-col size="6" *ngIf="guia.verificada">
                  <strong>Distancia</strong> : {{guia.distancia.toFixed(2) }} km  <strong>Duración</strong> : {{guia.duracion.toFixed(2)}} minutos
                </ion-col>
                <ion-col size="12">
                  <ion-row class="header-row">
                    <ion-col size="4" class="ion-text-wrap">Clientes</ion-col>
                    <ion-col size="4" class="ion-text-wrap">Facturas</ion-col>
                    <ion-col size="4" class="ion-text-wrap">Bultos</ion-col>
                
                  </ion-row>
                 </ion-col>
                 <ion-col size="4"> {{guia.clientes.length}}</ion-col>
                 <ion-col size="4"> {{guia.totalFacturas}}</ion-col>
                 <ion-col size="4">{{guia.camion.volumen.toFixed(2) }}</ion-col>

         <ion-col size="12">
          <ion-row class="header-row">
            <ion-col size="4" class="ion-text-wrap">Peso Total</ion-col>
            <ion-col size="4" class="ion-text-wrap">Actual</ion-col>
            <ion-col size="4" class="ion-text-wrap">Restante</ion-col>
        
          </ion-row>
         </ion-col>
                <ion-col size="4">{{guia.camion.capacidad.toFixed(2) }}</ion-col>
                <ion-col size="4">{{guia.camion.peso.toFixed(2) }}</ion-col>
                <ion-col size="4">{{guia.camion.pesoRestante.toFixed(2)}}</ion-col>
               
                <ion-col size="12"></ion-col>
              </ion-row>
            </ion-grid>
      
          </ion-card-content>
  
          <span style="position: absolute; top: -2rem; right: -1rem; display: flex;justify-content: space-around;">
            <ion-fab-button  (click)="time(guia)"   size="small" class="custom-button" color="primary"  >
              <ion-icon   name="time-outline"></ion-icon>
            </ion-fab-button>
            <ion-fab-button  (click)="verificarGuia(guia)" size="small" class="custom-button" color="primary"  >
              <ion-icon   name="settings-outline"></ion-icon>
            </ion-fab-button>
            <ion-fab-button  *ngIf="guia.verificada" (click)="mapa(guia)" size="small" class="custom-button" color="dark"  >
              <ion-icon   name="map-outline"></ion-icon>
            </ion-fab-button>
            <ion-fab-button (click)="detalleGuia(guia)" size="small"  class="custom-button"  color="primary"  >
              <ion-icon    name="create-outline"></ion-icon>
            </ion-fab-button>
            <ion-fab-button (click)="borrarGuia(guia)" size="small" class="custom-button" color="danger"  >
              <ion-icon   name="trash-outline"></ion-icon>
            </ion-fab-button>
          </span>
        </ion-card>
      </ion-col>
    </ion-row>
  


  </ion-col>


  <ion-col   size="{{controlCamionesGuiasService.listaGuias.length > 0 ? 8 : 12}}">  
    <ion-row  *ngIf="facturas.length > 0" class="ion-text-left">
      <ion-col   size="2">
        <ion-label class="ion-margin"><strong>Peso</strong>: {{controlCamionesGuiasService.pesoTotal.toFixed(2)}} KG </ion-label>
      </ion-col>
      <ion-col   size="2">
        <ion-label class="ion-margin"> {{controlCamionesGuiasService.totalBultos.toFixed(2)}} Bultos</ion-label>
      </ion-col>
      <ion-col   size="2">
        <ion-label class="ion-margin"><strong>Volumen</strong>:   {{controlCamionesGuiasService.volumenTotal.toFixed(2)}}</ion-label>
      </ion-col>
      <ion-col   size="2">
        <ion-label class="ion-margin"><strong>Clientes</strong>:   {{controlCamionesGuiasService.totalClientes}}</ion-label>
      </ion-col>
      <ion-col  size="4">
        <ion-label class="ion-margin"><strong style="margin-right: 1rem;">Fecha</strong>  <ion-badge color="warning" mode="ios">{{fecha}}</ion-badge></ion-label>
      </ion-col>
      <ion-col  size="8" style="display: flex;justify-content: end;align-items:flex-end">
        <ion-fab-button color="dark" (click)="consultarFacturas()" class="ion-margin-right"  size="small">
          <ion-icon name="search-outline"></ion-icon>
         </ion-fab-button>
      
   <ion-fab-button color="dark" (click)="filtrar()" class="ion-margin-right"  size="small">
    <ion-icon name="funnel-outline"></ion-icon>
   </ion-fab-button>

      </ion-col>
      <ion-col  size="4">
        <ion-searchbar color="dark" placeholder="Buscar Factura" inputmode="numeric" type="numeric" [(ngModel)]="textFactura" (ionChange)="buscarFactura($event)" [debounce]="1500" showCancelButton="focus"></ion-searchbar>
      </ion-col>
    </ion-row>

<ion-row  *ngIf="facturas.length >0">
 

  <ion-col size="12"   class="fixed-content-facturas "> 

  <ion-item *ngFor="let cliente of facturas" lines="none">
    <ion-grid >
      <ion-row>
        <ion-col size="12" >
    <ion-item lines="none">
      <ion-label class="ion-text-wrap ion-text-uppercase" slot="start"  style="display: flex;justify-content:left;align-items:center">
        
        <ion-badge style="margin-right: 1rem;"  color="primary" mode="ios" >{{cliente.id}}</ion-badge>
        <strong>{{cliente.nombre}}</strong></ion-label>
      
    </ion-item>
        </ion-col>

        <ion-col size="12" >
          <ion-row class="header-row">
            <ion-col size="4" class="ion-text-wrap">Factura</ion-col>
            <ion-col size="2" class="ion-text-wrap">Fecha Pedido</ion-col>
            <ion-col size="2" class="ion-text-wrap">Frio / Seco</ion-col>
            <ion-col size="1" class="ion-text-wrap">Bultos</ion-col>
            <ion-col size="1" class="ion-text-wrap">Peso</ion-col>
            <ion-col size="2" class="ion-text-wrap"></ion-col>


          </ion-row>

          <ion-row class="data-row"  *ngFor="let factura of cliente.facturas" >
            <ion-col size="4">
             <ion-row>
              <ion-col size="12">
                <ion-label class="ion-text-wrap">{{factura.FACTURA}}</ion-label>
              </ion-col>
              <ion-col size="12" >
                <ion-badge *ngIf="factura.ID_GUIA"  color="primary" mode="ios">{{factura.ID_GUIA}}</ion-badge>
          
              </ion-col>
             </ion-row>
            </ion-col>
        
            <ion-col size="2">
              <ion-label class="ion-text-wrap">{{factura.FECHA_PEDIDO  | date:'mediumDate' }}</ion-label>
            </ion-col>
     
            <ion-col size="2" class="ion-text-center">

              <ion-icon size="large" color="primary" *ngIf="factura.FRIO_SECO == 'F'" name="snow-outline"></ion-icon>


              
            </ion-col>
            <ion-col size="1">
              <ion-label class="ion-text-wrap">{{factura.RUBRO1}}</ion-label>
            </ion-col>
            <ion-col size="1">
              <ion-label class="ion-text-wrap">{{factura.TOTAL_PESO_NETO}}</ion-label>
            </ion-col>
            <ion-col size="2" class="ion-text-center ion-text-wrap" >
              <ion-button   (click)="controlFacturas(factura)"  fill="clear"  >
                <ion-icon color="dark" slot="icon-only" name="create"></ion-icon>
               </ion-button>
              <ion-button     *ngIf="factura.ID_GUIA" (click)="controlCamionesGuiasService.borrarFacturaGuia(factura)"   fill="clear"  >
               <ion-icon color="danger" slot="icon-only" name="trash"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>

    

        </ion-col>
      </ion-row>
    </ion-grid>
      </ion-item>
  </ion-col>
</ion-row>

  </ion-col>
</ion-row>

</ion-grid>
 

  





</ion-content>