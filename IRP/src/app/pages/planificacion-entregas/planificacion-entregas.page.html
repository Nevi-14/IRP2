<ion-header class="ion-no-border">
  <ion-toolbar color="dark">


    <ion-list style="background: transparent!important;margin:0;padding:0" lines="none">
      <ion-item>
        <ion-title class="ion-text-left" style="font-size: 0.9rem;letter-spacing: 0.2rem; text-transform: uppercase;" color="light">Planificaci√≥n de entregas</ion-title>

        <ion-label color="light">
          <h2 class="ion-text-uppercase">Ruta</h2>
          <p *ngIf="controlCamionesGuiasService.rutaZona">
            <ion-badge color="primary" mode="ios" >{{controlCamionesGuiasService.rutaZona.Ruta}}</ion-badge>
          </p>
        </ion-label>
        <ion-label color="light">
          <h2 class="ion-text-uppercase">Zona</h2>
          <p  *ngIf="controlCamionesGuiasService.rutaZona">
            <ion-badge color="primary" mode="ios">{{controlCamionesGuiasService.rutaZona.Descripcion}}</ion-badge>
          </p>
        </ion-label>
  
<ion-buttons slot="end" >

  <ion-button   [routerLink]="['/inicio']" fill="solid" shape="round" color="dark" size="small">
    <ion-icon name="home-outline"></ion-icon>
      </ion-button>
      <ion-button *ngIf="controlCamionesGuiasService.listaGuias.length > 0"    shape="round"  fill="clear"  (click)="onOpenMenuGuias()" >
        <ion-chip  style="background: transparent!important;">
          <ion-avatar >
            <img   [src]="image" />
          </ion-avatar>
          <ion-label color="light">Gestionar Guias</ion-label>
            </ion-chip>
      </ion-button>
  <ion-button  shape="round" fill="solid" color="dark" (click)="gestionErrores()">
    <ion-icon  name="bug"></ion-icon>
    <ion-badge color="primary" mode="ios">{{planificacionEntregasService.errorArray.length}}</ion-badge>
  </ion-button>
  <ion-button   *ngIf="controlCamionesGuiasService.rutaZona" (click)="limpiarDatos()"  shape="round" fill="solid" color="dark">
    <ion-icon  name="refresh"></ion-icon>
      </ion-button>
      <ion-button  shape="round" fill="solid" color="dark" (click)="configuracionZonaRuta()">
        <ion-icon class="spin-element"  name="settings"></ion-icon>
      </ion-button>
      <ion-button *ngIf="controlCamionesGuiasService.rutaZona" shape="round" fill="solid" color="dark" (click)="calendarioModal()">
        <ion-icon   name="calendar"></ion-icon>
      </ion-button>
  
  <ion-button    [routerLink]="['/log-in']" fill="solid" shape="round" color="danger" size="small">
    <ion-label slot="start">Salir</ion-label>
    <ion-icon name="close" slot="end"> </ion-icon>
  </ion-button>
</ion-buttons>
      </ion-item>
    
    </ion-list>
  </ion-toolbar>


</ion-header>

<ion-content>
       



  <ion-grid *ngIf="planificacionEntregasService.planificacionEntregaArray.length == 0" style="display: flex;justify-content: center;align-items: center; height: 100%;">
    <ion-row style="display: flex;justify-content: center;align-items: center; height: 100%;">
      <ion-col size="5" style="margin: 0 auto;">
       
          <img  class="slide-image" src="../assets/icons/delivery-truck.svg" />
     <ion-card-content>
     <h2 class="ion-text-uppercase"> Gestiona la planificacion de entregas presionando el boton de configuracion en la parte superior derecha</h2>
     </ion-card-content>
          
    
      </ion-col>
    </ion-row>
  </ion-grid>





  <ion-grid  *ngIf="planificacionEntregasService.planificacionEntregaArray.length > 0"> 


<ion-row *ngIf="controlCamionesGuiasService.listaGuias.length > 0">
  <ion-col >

    <h4    class="ion-text-uppercase" style="letter-spacing: 0.1rem;">Lista De guias <ion-badge color="dark" mode="ios">{{controlCamionesGuiasService.listaGuias.length}}</ion-badge></h4>

    <ion-fab-button *ngIf="controlCamionesGuiasService.listaGuias.length > 3"  size="small"  color="dark"  class="custom-button" style="position: absolute;top: 50%;left: 0px;z-index: 2;"  (click)="slidePrev()" >
      <ion-icon  size="large"  name="chevron-back-outline"></ion-icon>
    </ion-fab-button>
  
    <ion-fab-button *ngIf="controlCamionesGuiasService.listaGuias.length > 3"  size="small"  color="dark" class="custom-button" style="position: absolute;top: 50%;right:0px;z-index: 2;" (click)="slideNext()" >
      <ion-icon  size="large" name="chevron-forward-outline"></ion-icon>
    </ion-fab-button>
  
    <ion-slides   [options]="avatarSlide" class="ion-padding">
      <ion-slide *ngFor="let guia of controlCamionesGuiasService.listaGuias;let i = index">
  
  <ion-card >

  <ion-card-content style="text-align: left;">
    
    <ion-label>
    <p><ion-badge color="dark" mode="ios">{{ guia.guiaExistente ? 'Guia existente' : 'Nueva Guia'}}</ion-badge></p>
      <p> {{guia.camion.chofer}}</p>
      <p>Placa : {{guia.camion.idCamion}}</p>
      <p>Consecutivo : {{guia.idGuia}}</p>
      <p>Total Facturas : <ion-badge  color="dark" mode="ios">{{guia.totalFacturas}}</ion-badge></p>
      <p>Total Bultos : {{guia.camion.volumen.toFixed(2) }}</p>
      <p>Capacidad Total : {{guia.camion.capacidad.toFixed(2) }}</p>
      <p>Capacidad Actual : {{guia.camion.peso.toFixed(2) }}</p>
      <p>Capacidad Restante : {{guia.camion.pesoRestante.toFixed(2)}}</p>
      <p *ngIf="guia.verificada">Distancia : {{guia.distancia.toFixed(2) }} km / Duracion : {{guia.duracion.toFixed(2)}} minutos</p>

  
  
    </ion-label>

  </ion-card-content>
  
  <span style="position: absolute; top: -15px; right: 0; display: flex;justify-content: space-around;">
    <ion-fab-button  (click)="verificarGuia(guia)" size="small" class="custom-button" color="primary"  >
      <ion-icon   name="settings-outline"></ion-icon>
    </ion-fab-button>
    <ion-fab-button  *ngIf="guia.verificada" (click)="mapa(guia)" size="small" class="custom-button" color="dark"  >
      <ion-icon   name="map-outline"></ion-icon>
    </ion-fab-button>



    <ion-fab-button (click)="detalleGuia(guia)" size="small"  class="custom-button"  color="primary"  >
    
      <ion-icon    name="create-outline"></ion-icon>
    </ion-fab-button>
   

    <ion-fab-button (click)="borrarGuia(guia.idGuia)" size="small" class="custom-button" color="danger"  >
      <ion-icon   name="trash-outline"></ion-icon>
    </ion-fab-button>
  </span>
  
  </ion-card>
       
  
    
      </ion-slide>
      </ion-slides>
    
  </ion-col>
</ion-row>


    
    <ion-row>
   
<ion-col   size="4">

<ion-label class="ion-margin">Peso Total : {{planificacionEntregasService.pesoTotal.toFixed(2)}} KG </ion-label>

</ion-col>


<ion-col   size="4">
<ion-label class="ion-margin">Total Bultos:   {{planificacionEntregasService.bultosTotales.toFixed(2)}} Bultos</ion-label>

</ion-col>
<ion-col  size="4">
  
  <ion-label class="ion-margin">Fecha de entrega  {{planificacionEntregasService.fecha}}</ion-label>
  
</ion-col>
    </ion-row>

    <ion-row class="header-row">



      <ion-col size="3" tappable (click)="datableService.sortBy('FACTURA')">
<ion-label class="ion-margin">Total Clientes {{planificacionEntregasService.totalClientes}} /  Facturas : {{planificacionEntregasService.totalFacturas}}</ion-label>
      <ion-icon  name="arrow-down" *ngIf="datableService.sortDirection == 1"></ion-icon>
      <ion-icon  name="arrow-up" *ngIf="datableService.sortDirection == 2"></ion-icon>
      </ion-col>

<ion-col size="9">
<ion-grid >
  <ion-row>
    <ion-col   size="3">
      <ion-label class="ion-margin">Factura</ion-label>
      
      
    </ion-col>
    <ion-col   size="2">
      <ion-label class="ion-margin">Frio</ion-label>


    </ion-col>
    <ion-col   size="2"> <ion-label class="ion-margin">Seco</ion-label></ion-col>
    <ion-col    size="2"> <ion-label class="ion-margin">Bultos</ion-label></ion-col>
    <ion-col   size="2"> <ion-label class="ion-margin">Peso</ion-label></ion-col>

  </ion-row>
</ion-grid>
  
</ion-col>
    </ion-row >
      <ion-row *ngFor="let cliente of datableService.dataArrayToShow">
        <ion-col size="3">

          <ion-label>
            <h2 class="ion-margin"> <ion-badge color="dark" mode="ios">{{cliente.cliente}}</ion-badge></h2>
            <p class="ion-text-wrap">{{cliente.direccion}}</p>
            <p *ngIf="!cliente.incluir" class="ion-text-warp">

            <ion-label color="danger" class="ion-text-uppercase">  Clientes sin latitud ni longitud no pueden ser parte del proceso de planificacion de entrega</ion-label>


            </p>
          </ion-label>
        </ion-col>

        <ion-col size="9">
          <ion-item (click)="controlFacturas(factura)"   *ngFor="let factura of cliente.facturas" detail>
     <ion-grid >
      <ion-row  >
        <ion-col   size="3" style="display: flex;justify-content: start;align-items: center;">
      <ion-label class="ion-text-wrap">
       <span *ngIf="factura.idGuia">Guia <ion-badge color="primary" mode="ios">{{factura.idGuia}}</ion-badge></span>
        {{factura.factura.FACTURA}}
    
      </ion-label>
          
          
        </ion-col>
        <ion-col   size="2" style="display: flex;justify-content: left;align-items: left;">
        
      <ion-checkbox disabled="true"   [(ngModel)]="factura.factura.FRIO_SECO == 'F' ? verdadero : falso " ></ion-checkbox>
        </ion-col>
        <ion-col   size="2" style="display: flex;justify-content: left;align-items: left;">
          <ion-checkbox disabled="true" [(ngModel)]="factura.factura.FRIO_SECO == 'S' ? verdadero : falso " ></ion-checkbox>
        </ion-col>
        <ion-col   size="2" style="display: flex;justify-content: left;align-items: left;">{{factura.factura.RUBRO1}}</ion-col>
        <ion-col   size="2" style="display: flex;justify-content: left;align-items: left;"> {{factura.factura.TOTAL_PESO_NETO}}</ion-col>
    
      </ion-row>
     </ion-grid>
          </ion-item>
       
          
        </ion-col>
      </ion-row>

      <ion-row>


        <ion-col size="12" class="ion-text-center">

          Pagina {{datableService.page + 1 }} de {{datableService.totalPages}}
        </ion-col>
      </ion-row>

      <ion-row>
    
        <ion-col size="6" size-md="2" >
      <ion-item lines="none" *ngIf="datableService.page > 0"> 
        <ion-button (click)="datableService.prevPage()"  fill="clear" slot="start">
          <ion-icon slot="start" name="play-back"></ion-icon>
          <ion-label>Anterior</ion-label>
          </ion-button>
      </ion-item>
        </ion-col>
        <ion-col size="6" size-md="2" >
          <ion-item lines="none" *ngIf="datableService.page > 0"> 
            <ion-button (click)="datableService.goFirst()"  fill="clear" slot="start">
              <ion-icon slot="start" name="play-back"></ion-icon>
             <ion-label> Primer pagina</ion-label>
              </ion-button>
          </ion-item>
            </ion-col>


        <ion-col size="12" size-md="4"  class="ion-text-center">
          <ion-select interface="popover" [(ngModel)]="datableService.resultsCount" (ionChange)="datableService.loadData()">
            <ion-select-option [value]="5">5</ion-select-option>
            <ion-select-option [value]="10">10</ion-select-option>
            <ion-select-option [value]="25">25</ion-select-option>
            <ion-select-option [value]="50">50</ion-select-option>
            <ion-select-option [value]="datableService.data.length">Todos</ion-select-option>
            
          </ion-select>
          
        </ion-col>

        <ion-col size="6" size-md="2" >
          <ion-item lines="none" *ngIf="datableService.page+1 < datableService.totalPages"> 
            <ion-button (click)="datableService.goLast()"  fill="clear" slot="start">
            
             <ion-label> Ultima pagina</ion-label>
             <ion-icon slot="end" name="play-forward"></ion-icon>
              </ion-button>
          </ion-item>
            </ion-col>
        <ion-col  size="6" size-md="2">
      <ion-item lines="none" *ngIf="datableService.page+1 < datableService.totalPages">
        <ion-button (click)="datableService.nextPage()"  fill="clear" slot="end">
          <ion-label>Siguiente</ion-label>
          <ion-icon slot="end" name="play-forward"></ion-icon>
          </ion-button>
      </ion-item>
        </ion-col>
      </ion-row>
 
  </ion-grid>


  
  </ion-content>
  