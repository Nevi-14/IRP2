<ion-header class="ion-no-border">
  <ion-toolbar color="dark">


    <ion-list style="background: transparent!important;margin:0;padding:0" lines="none">
      <ion-item>
        <ion-title class="ion-text-left" style="font-size: 0.9rem;letter-spacing: 0.2rem; text-transform: uppercase;" color="light">Planificaci√≥n de entregas</ion-title>

        <ion-label color="light">
          <h2 class="ion-text-uppercase">Ruta</h2>
          <p *ngIf="rutaZona">
            <ion-badge color="primary" mode="ios" >{{rutaZona.Ruta}}</ion-badge>
          </p>
        </ion-label>
        <ion-label color="light">
          <h2 class="ion-text-uppercase">Zona</h2>
          <p  *ngIf="rutaZona">
            <ion-badge color="primary" mode="ios">{{rutaZona.Descripcion}}</ion-badge>
          </p>
        </ion-label>

<ion-buttons slot="end" >
  <ion-button   [routerLink]="['/inicio']" fill="solid" shape="round" color="dark" size="small">
    <ion-icon name="home-outline"></ion-icon>
      </ion-button>
  <ion-button  shape="round" fill="solid" color="dark" (click)="gestionErrores()">
    <ion-icon  name="bug"></ion-icon>
    <ion-badge color="primary" mode="ios">{{planificacionEntregasService.errorArray.length}}</ion-badge>
  </ion-button>
  <ion-button   *ngIf="rutaZona" (click)="limpiarDatos()"  shape="round" fill="solid" color="dark">
    <ion-icon  name="refresh"></ion-icon>
      </ion-button>
      <ion-button  shape="round" fill="solid" color="dark" (click)="configuracionZonaRuta()">
        <ion-icon class="spin-element"  name="settings"></ion-icon>
      </ion-button>
      <ion-button *ngIf="rutaZona" shape="round" fill="solid" color="dark" (click)="calendarioModal()">
        <ion-icon   name="calendar"></ion-icon>
      </ion-button>
  
  <ion-button    [routerLink]="['/log-in']" fill="solid" shape="round" color="danger" size="small">
    <ion-label slot="start">Salir</ion-label>
    <ion-icon name="close" slot="end"> </ion-icon>
  </ion-button>
</ion-buttons>
      </ion-item>
    
    </ion-list>
  </ion-toolbar>


</ion-header>

<ion-content>


  <ion-grid *ngIf="planificacionEntregasService.rutaFacturasArray.length == 0" style="display: flex;justify-content: center;align-items: center; height: 100%;">
    <ion-row style="display: flex;justify-content: center;align-items: center; height: 100%;">
      <ion-col size="5" style="margin: 0 auto;">
       
          <img  class="slide-image" src="../assets/icons/delivery-truck.svg" />
     <ion-card-content>
     <h2 class="ion-text-uppercase"> Gestiona la planificacion de entregas presionando el boton de configuracion en la parte superior derecha</h2>
     </ion-card-content>
          
    
      </ion-col>
    </ion-row>
  </ion-grid>


          

  <ion-grid  *ngIf="planificacionEntregasService.rutaFacturasArray.length > 0"> 
    <ion-row class="header-row">
      <ion-col size="12" size-md="8"   >

<ion-item lines="none">
   

  <ion-label class="ion-text-uppercase">Lista de clientes</ion-label>
  <ion-label slot="end">Total Guias <ion-badge color="dark" mode="ios">{{controlCamionesGuiasService.listaCamionesGuia.length}}</ion-badge></ion-label>
  <ion-buttons  slot="end">
           

            <ion-button (click)="listaCamiones()" shape="round"  fill="outline"  color="success">
              <ion-chip  style="background: transparent!important;">
                <ion-avatar >
                  <img   [src]="image" />
                </ion-avatar>
                <ion-label color="dark">Camiones</ion-label>
                  </ion-chip>
            </ion-button>
            <ion-button (click)="generarPost()" *ngIf="controlCamionesGuiasService.listaCamionesGuia.length > 0" shape="round"  fill="outline"  color="primary">
              <ion-chip  style="background: transparent!important;">
                <ion-avatar >
                  <img   [src]="image" />
                </ion-avatar>
              <ion-label>  <ion-icon  color="primary" slot="icon-only" name="save"></ion-icon></ion-label>
                  </ion-chip>
            </ion-button>
            <ion-button *ngIf="controlCamionesGuiasService.listaCamionesGuia.length > 0" (click)="controlCamionesGuiasService.eliminarTodosCamionesAlert()" shape="round"  fill="outline"  color="danger">
              <ion-chip  style="background: transparent!important;">
                <ion-avatar >
                  <img   [src]="image" />
                </ion-avatar>
              <ion-label>  <ion-icon  color="danger" slot="icon-only" name="close"></ion-icon></ion-label>
                  </ion-chip>
            </ion-button>


           </ion-buttons>
           
</ion-item>
    

      
      </ion-col>
      <ion-col size="12" size-md="4">
        <ion-searchbar mode="ios" placeholder="Buscar cliente" (ionChange)="datableService.onSearchChange($event)" ></ion-searchbar>

      </ion-col>
<ion-col size="12" >
<ion-row>
  <ion-col size="12" size-md="4"*ngFor="let camion of  controlCamionesGuiasService.listaCamionesGuia">

    
    <ion-row>
      <ion-col size="12" size-md="3">
        <ion-avatar >
          <img [src]="image" />
          </ion-avatar>
          <ion-label>
            {{camion.idCamion}}</ion-label>

      </ion-col>

      <ion-col size="12" size-md="9">
      
    
<ion-card style="width: 100%; height: auto;">
  <ion-card-content>
    <ion-label>
    <p><ion-badge color="dark" mode="ios">{{ camion.guiaExistente ? 'Guia existente' : 'Nueva Guia'}}</ion-badge></p>
      <p> {{camion.chofer}}</p>
      <p>Placa : {{camion.idCamion}}</p>
      <p>Consecutivo : {{camion.consecutivo}}</p>
      <p>Total Facturas : <ion-badge  color="dark" mode="ios">{{camion.numClientes}}</ion-badge></p>
      <p>Total Bultos : {{camion.volumen.toFixed(2) }}</p>
      <p>Capacidad Total : {{camion.capacidad.toFixed(2) }}</p>
      <p>Capacidad Actual : {{camion.peso.toFixed(2) }}</p>
      <p>Capacidad Restante : {{camion.pesoRestante.toFixed(2)}}</p>


    </ion-label>
    <ion-item lines="none">
        
      <ion-buttons slot="end">
        <ion-button  fill="clear" color="danger"  (click)="removerGuia(camion.consecutivo)">
          <ion-icon slot="start" name="close"></ion-icon>
          <ion-label>Eliminar</ion-label>
    
        </ion-button>
        <ion-button  (click)="mostrarDetalleGuia(camion.consecutivo)"   fill="clear" color="primary">
          <ion-icon slot="start" name="create"></ion-icon>
          <ion-label>Editar</ion-label>
        </ion-button>
      </ion-buttons>
    </ion-item>
  </ion-card-content>


</ion-card>
       
    
      </ion-col>
    </ion-row>

  </ion-col>
</ion-row>
  



</ion-col>



<ion-col   size="4">Peso Total : {{planificacionEntregasService.pesoTotal.toFixed(2)}} KG </ion-col>
<ion-col   size="4">Total Bultos:   {{planificacionEntregasService.bultosTotales.toFixed(2)}} Bultos</ion-col>
<ion-col  size="4">Fecha de entrega  {{planificacionEntregasService.fecha}}</ion-col>
    </ion-row>

    <ion-row class="header-row">



      <ion-col size="2" tappable (click)="datableService.sortBy('FACTURA')">

      Total Clientes : {{planificacionEntregasService.clientesTotales}} 
      <ion-icon  name="arrow-down" *ngIf="datableService.sortDirection == 1"></ion-icon>
      <ion-icon  name="arrow-up" *ngIf="datableService.sortDirection == 2"></ion-icon>
      </ion-col>
<ion-col size="10">
  <ion-row>
    <ion-col   size="4">Factura</ion-col>
    <ion-col   size="1">Frio



    </ion-col>
    <ion-col   size="1">Seco</ion-col>
    <ion-col    size="1">Bultos</ion-col>
    <ion-col   size="1">Peso</ion-col>
    <ion-col   size="4">Consecutivo</ion-col>
  </ion-row>
  
</ion-col>

     
    </ion-row>

   
      <ng-template ngFor let-factura [ngForOf]="datableService.dataArrayToShow " let-i="index" let-odd="odd" >
        <ion-row class="data-row">
          <ion-col size="2" *ngIf="datableService.bulkEdit">
            <ion-checkbox disabled="true" [(ngModel)]="datableService.edit[i]"></ion-checkbox>
          </ion-col>
        <ion-col size="2"   >
     <ion-label>
       <h2>     {{factura.cliente}}</h2>
       <p class="ion-text-wrap">{{factura.direccion}}</p>

     </ion-label>
        
        </ion-col>
    <ion-col size="10">
   
        <ion-row  [ngClass]="odd ? 'odd' : 'even'"   *ngFor="let facturaCliente of factura.facturas let odd = odd">
          <ion-col size="4">
            {{facturaCliente.factura.FACTURA}}
          </ion-col>
        <ion-col    size="1">
 
          <ion-checkbox disabled="true"   [(ngModel)]="facturaCliente.factura.FRIO_SECO == 'F' ? verdadero : falso " ></ion-checkbox>
        </ion-col>
        <ion-col    size="1">
  
          <ion-checkbox disabled="true" [(ngModel)]="facturaCliente.factura.FRIO_SECO == 'S' ? verdadero : falso " ></ion-checkbox>
        </ion-col>
        <ion-col    size="1">
{{facturaCliente.factura.RUBRO1}}
        </ion-col>
        <ion-col    size="1" >
          {{facturaCliente.factura.TOTAL_PESO_NETO}}
        </ion-col>

        <ion-col    size="4"  >
          <ion-label style="display: flex;justify-content:center ;align-items: center;">   
    
    <h2  *ngIf="facturaCliente.idGuia"> {{facturaCliente.idGuia}}</h2>
    <p >
    
      <ion-buttons>
      <ion-button  *ngIf="facturaCliente.idGuia" (click)="agregarGuia(facturaCliente)" fill="clear" color="primary">
        <ion-icon slot="icon-only" name="create"></ion-icon>
    
      </ion-button>
      <ion-button *ngIf="facturaCliente.idGuia"  (click)="controlCamionesGuiasService.removerFactura(facturaCliente)" fill="clear" color="danger">
        <ion-icon slot="icon-only" name="close"></ion-icon>
    
      </ion-button>

      <ion-badge color="dark" mode="ios" *ngIf="facturaCliente.factura.LONGITUD == null &&  facturaCliente.factura.LATITUD == null ">
        
        <ion-icon name="location-outline"></ion-icon> 
        Longitud o Latitud sin definir

        </ion-badge>
      <ion-buttons *ngIf="!facturaCliente.idGuia && facturaCliente.factura.LONGITUD != null &&  facturaCliente.factura.LATITUD != null  ">
        <ion-button  (click)="agregarGuia(facturaCliente)" fill="clear" color="primary">
          <ion-icon slot="icon-only" name="add"></ion-icon>
      
        </ion-button>
      </ion-buttons>
    </ion-buttons>
    </p>
          </ion-label>
      
              
     
      
        </ion-col>


     
      </ion-row>
   

      
    </ion-col>

      
      </ion-row>
      </ng-template>

      <ion-row>
        <ion-col size="12" class="ion-text-center">

          Pagina {{datableService.page + 1 }} de {{datableService.totalPages}}
        </ion-col>
      </ion-row>

      <ion-row>
    
        <ion-col size="6" size-md="2" >
      <ion-item lines="none" *ngIf="datableService.page > 0"> 
        <ion-button (click)="datableService.prevPage()"  fill="clear" slot="start">
          <ion-icon slot="start" name="play-back"></ion-icon>
          <ion-label>Anterior</ion-label>
          </ion-button>
      </ion-item>
        </ion-col>
        <ion-col size="6" size-md="2" >
          <ion-item lines="none" *ngIf="datableService.page > 0"> 
            <ion-button (click)="datableService.goFirst()"  fill="clear" slot="start">
              <ion-icon slot="start" name="play-back"></ion-icon>
             <ion-label> Primer pagina</ion-label>
              </ion-button>
          </ion-item>
            </ion-col>
        <ion-col size="12" size-md="4"  class="ion-text-center">
          <ion-select interface="popover" [(ngModel)]="datableService.resultsCount" (ionChange)="datableService.loadData()">
            <ion-select-option [value]="5">5</ion-select-option>
            <ion-select-option [value]="10">10</ion-select-option>
            <ion-select-option [value]="25">25</ion-select-option>
            <ion-select-option [value]="50">50</ion-select-option>
            <ion-select-option [value]="datableService.data.length">Todos</ion-select-option>
            
          </ion-select>
          
        </ion-col>
        <ion-col size="6" size-md="2" >
          <ion-item lines="none" *ngIf="datableService.page+1 < datableService.totalPages"> 
            <ion-button (click)="datableService.goLast()"  fill="clear" slot="start">
            
             <ion-label> Ultima pagina</ion-label>
             <ion-icon slot="end" name="play-forward"></ion-icon>
              </ion-button>
          </ion-item>
            </ion-col>
        <ion-col  size="6" size-md="2">
      <ion-item lines="none" *ngIf="datableService.page+1 < datableService.totalPages">
        <ion-button (click)="datableService.nextPage()"  fill="clear" slot="end">
          <ion-label>Siguiente</ion-label>
          <ion-icon slot="end" name="play-forward"></ion-icon>
          </ion-button>
      </ion-item>
        </ion-col>
       
      </ion-row>

 
  </ion-grid>


  
  </ion-content>
  